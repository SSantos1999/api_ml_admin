<!DOCTYPE html>
{% extends "base.html" %}
{% block content %}
<html>

<head>
	<script src="{{ url_for('static', filename='js/jquery-3.5.1.min.js') }}"></script>
	<script src="{{ url_for('static', filename='js/jquery.easypiechart.js') }}"></script>
	<script src="{{ url_for('static', filename='js/Chart.min.js') }}"></script>
	<script src="https://cdn.jsdelivr.net/gh/emn178/chartjs-plugin-labels/src/chartjs-plugin-labels.js"></script>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body onload="GetDateTime();">
	
	<div class="container">

		<div class="leftHalf">
			<br><br><br><br><br><br><br><br><br><br>


			<div class="barChartDiv">
				<i class="fa fa-question-circle" style="font-size:24px;position:absolute;left:520px" id="StepHelp"></i>
				<canvas id="StepChart1" width='500' height='300'></canvas>
			</div>


			<div class="lineChartDiv">
				<i class="fa fa-question-circle" style="font-size:24px;position:absolute;left:520px;"
					id="HeartHelp"></i>
				<canvas id="HeartChart2" width='500' height='300'></canvas>

			</div>


			<div class="lineChartDiv">
				<i class="fa fa-question-circle" style="font-size:24px;position:absolute;left:520px"
					id="CaloriesHelp"></i>
				<canvas id="CaloriesChart" width='500' height='300'></canvas>
			</div>
			<div class="lineChartDiv">
				<i class="fa fa-question-circle" style="font-size:24px;position:absolute;left:520px"
					id="DistanceHelp"></i>
				<canvas id="DistanceChart" width='500' height='300'></canvas>
			</div>
			<div class="lineChartDiv">
				<i class="fa fa-question-circle" style="font-size:24px;position:absolute;left:520px"
					id="FloorsHelp"></i>
				<canvas id="FloorsChart" width='500' height='300'></canvas>
			</div>
			<div class="lineChartDiv">
				<canvas id="ElevationChart" width='500' height='300'></canvas>
			</div>

		</div>


		<div class="rightHalf">
			<br><br>
			<label for="start">Start date:</label>

			<input type="date" id="start">
			<label for="end">End date:</label>

			<input type="date" id="end">
			<button id="refresh" onclick="GetData()">Get Info</button>
			<div
			style="position:absolute;left:110px;width:100% right:10px; top:80px;border: 1px solid green;border-radius: 25px">
			<h1 class="heading">Health Score:</h1><br>

			</div>
			<br><br><br><br><br><br><br><br><br><br>
			<table id="table" style="width:70%;border: 1px solid black;position:relative;left:100px;visibility:visible">
				<tr style="border: 1px solid black;">
				  <th>Fitbit</th>
				  <th>Summary</th>
				</tr>
				<tr>
				  <td>Distance tracked by Fitbit</td>
				  <td id="trackedDistance">{{ Summary[7] }} miles

			
				  </td>
				</tr>
				<tr>
				  <td>Resting Heartrate</td>
				  <td id="restingHeartrate">{{ Summary[3] }} beats per minute
					
				  </td>
				  
				</tr>
				<tr>
					<td>Active Score</td>
					<td id="activescore">{{ Summary[1] }}
						
					</td>
					
				</tr>
				<tr>
					<td>Activities Distance</td>
					<td id="activityDistance">{{ Summary[8] }} miles
						
					</td>
					
				</tr>
				<tr>
					<td>Time Asleep</td>
					<td id="minutesAsleep">{{ Summary[6] }} minutes
						
					</td>
					
				</tr>
				<tr>
					<td>Calories Out</td>
					<td id="caloriesOut">{{ Summary[5] }} calories
					
					</td>
					
				</tr>
				<tr>
					<td>Out Of Range</td>
					<td id="outOfRange">{{ Summary[4] }}
					
					</td>
					
				</tr>
				<tr>
					<td>TrackerDistance</td>
					<td id="Tracker Distance">{{ Summary[7] }} miles

					</td>
					
				</tr>
				<tr>
					<td>Minutes Awake</td>
					<td id="MinutesAwake">{{ Summary[9] }} minutes

					</td>
					
				</tr>
				<tr>
					<td>Minutes in Rem Sleep</td>
					<td id="MinutesRem">{{ Summary[10] }} minutes

					</td>
					
				</tr>
				<tr>
					<td>Minutes of Light sleep</td>
					<td id="MinutesLight">{{ Summary[11] }} minutes

					</td>
					
				</tr>
				<tr>
					<td>Minutes of deep sleep</td>
					<td id="MinutesDeep">{{ Summary[12] }} minutes

					</td>
					
				</tr>

			</table> 
			<br><br><br>
			<div class="pieChartDiv">
				<i class="fa fa-question-circle" style="font-size:24px;position:absolute;left:400px" id="ActivityHelp"></i>
				<canvas id="ActivityChart" width='300' height='100'></canvas>
			</div>
			<br>
			<div class="pieChartDiv">
				<i class="fa fa-question-circle" style="font-size:24px;position:absolute;left:400px" id="SleepTimeHelp"></i>
				<canvas id="SleepTimeChart" width='300' height='100'></canvas>
				
			</div>
			<br>
			<div class="pieChartDiv">
				<i class="fa fa-question-circle" style="font-size:24px;position:relative;top:30px;left:460px" id="SleepBreakdownHelp"></i>
				<canvas id="SleepChart" width='300' height='100'></canvas>
			</div>



		</div>








	</div>

	<script>


		//event listeners for the help icons
		StepMessage="It is recommended to get atleast 2000 steps every day.";
		HeartMessage="Resting Heart Rate\nGood: 60-100 bpm\n Could Improve: Less than 60 bpm or greater than 100 bpm";
		CaloriesMessage="This chart displays the calories burned\n within the given timeframe."
		DistanceMessage="This chart displays the distance traveled \n within the given timeframe."
		FloorsMessage="This chart displays the total floors gone up\n within the given timeframe."

		//create html elements so we can attach them to the help icons
		HeartHTML="<img class='heartrange' src='/static/images/heart_rate_ranges.png 'style='width:540px;height:540px;'>";
		HeartClass=".heartrange"

		ActivityHTML="<img class='activity' src='/static/images/activityminutes.png 'style='width:468px;height:130px;'>";
		ActivityClass=".activity"

		SleepTimeHTML="<img class='sleeptime' src='/static/images/sleepminutes.png 'style='width:343px;height:468px;'>";
		SleepTimeClass=".sleeptime"

		SleepBreakdownHTML="<img class='sleepbreakdown' src='/static/images/sleepbreakdown.png 'style='width:386px;height:473spx;'>";
		SleepBreakdownClass=".sleepbreakdown"


		//jquery event listeners that are fired once a user hovers over a help element
		$("#HeartHelp").hover(function () { tooltipTimeout = setTimeout(showHearttip('#HeartHelp',HeartHTML)); },
			hideHearttip);
		$("#ActivityHelp").hover(function () { tooltipTimeout = setTimeout(showtip('#ActivityHelp',ActivityHTML)); },
			hideActivitytip);
		$("#SleepTimeHelp").hover(function () { tooltipTimeout = setTimeout(showtip('#SleepTimeHelp',SleepTimeHTML)); },
			hideSleepTimetip);

		$("#SleepBreakdownHelp").hover(function () { tooltipTimeout = setTimeout(showtip('#SleepBreakdownHelp',SleepBreakdownHTML)); },
			hideSleepBreakdowntip);
		

		//function that is used to attach an image to a help icon
		//using the id of the help icon, and an html element containing the image
		//separate function because we need to hide the table and graphs on
		//the right side(pie charts,etc), otherwise the image clips through it
		function showHearttip(id,HTML) {
			var htmlelement=HTML
			var tip = $(htmlelement);
			$("table").css("visibility", "hidden");
			$(".pieChartDiv").css("visibility", "hidden");
			tip.appendTo($(id));

		}
		//function that shows/displays the help image by appending the image to the help icon
		function showtip(id,HTML) {
			var htmlelement=HTML
			var tip = $(htmlelement);
			tip.appendTo($(id));
			var maxScrollLeft = $(document).width() - $(window).width();
			$('html, body').scrollLeft(maxScrollLeft);
		}
		//these hide functions basically remove the image from the tooltip after the user
		//stops hovering their mouse over the help icon
		function hideHearttip() {
			clearTimeout(tooltipTimeout);
			$(".heartrange").fadeOut().remove();
			$("table").css("visibility", "visible");
			$(".pieChartDiv").css("visibility", "visible");
		}
		function hideActivitytip() {
			clearTimeout(tooltipTimeout);
			$(".activity").fadeOut().remove();
			$("table").css("visibility", "visible");
			$(".pieChartDiv").css("visibility", "visible");
		}
		function hideSleepTimetip() {
			clearTimeout(tooltipTimeout);
			$(".sleeptime").fadeOut().remove();
			$("table").css("visibility", "visible");
			$(".pieChartDiv").css("visibility", "visible");
		}
		function hideSleepBreakdowntip() {
			clearTimeout(tooltipTimeout);
			$(".sleepbreakdown").fadeOut().remove();
			$("table").css("visibility", "visible");
			$(".pieChartDiv").css("visibility", "visible");
		}









	</script>
	<script>
		//this function finds the current day to display as a default value for the calender
		function GetDateTime() {

			var today = new Date();
			var dd = String(today.getDate()).padStart(2, '0');
			var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
			var yyyy = today.getFullYear();

			today = yyyy + '-' + mm + '-' + dd;
			document.getElementById('start').value = today;

		}
	</script>

	<script>

		let labelsactivity = ['Sedentary', 'Lightly Active', "Very Active", "Fairly Active"];
		let activitychart = document.getElementById("ActivityChart").getContext('2d');
		let Sedentary={{ todayData[5] }};
		let LightlyActive={{ todayData[6] }};
		let VeryActive={{ todayData[7] }};
		let FairlyActive={{ todayData[8] }};
		let activitychart1 = new Chart(activitychart, {
			type: 'pie',

			data: {
				datasets: [{
					data: [Sedentary,LightlyActive,VeryActive,FairlyActive],
		backgroundColor: ["rgba(0,0,255,0.5)", "rgba(0,255,0,0.5)", "rgba(255,0,0,0.5)","rgba(255,255,0,0.5)"]
				}],
		labels: ['Sedentary', 'LightlyActive', 'VeryActive', 'Fairly Active']
			},

		options: {
			title: {
				text: "Activity Breakdown",
					display: true
			},
			hover: {
				mode: 'nearest',
					intersect: true
			},
			//centertext: "0"

		}

		});
		Chart.pluginService.register({
			beforeDraw: function (chart) {
				if (chart.options.centertext) {
					var width = chart.chart.width,
						height = chart.chart.height,
						ctx = chart.chart.ctx;

					ctx.restore();
					var fontSize = (height / 144).toFixed(2); // was: 114
					ctx.font = fontSize + "em sans-serif";
					ctx.textBaseline = "middle";

					var text = chart.options.centertext, // "75%",
						textX = Math.round((width - ctx.measureText(text).width) / 2),
						textY = height / 2 - (chart.titleBlock.height - 70);


					ctx.fillText(text, textX, textY);
					ctx.save();

					


				}
				if (chart.config.options.chartArea && chart.config.options.chartArea.backgroundColor) {
                    var ctx = chart.chart.ctx;
                    var chartArea = chart.chartArea;

                    ctx.save();
                    ctx.fillStyle = chart.config.options.chartArea.backgroundColor;
                    ctx.fillRect(chartArea.left, chartArea.top, chartArea.right - chartArea.left, chartArea.bottom - chartArea.top);
                    ctx.restore();
                }
			}
		});

	</script>

	<script>

		let sleepchart = document.getElementById("SleepChart").getContext('2d');
		let Awake = {{ Sleep[0] }};
		let Light = {{ Sleep[1] }};
		let Deep = {{ Sleep[2] }}
		let Rem = {{ Sleep[3] }};
		console.log(Awake);
		let sleepchart1 = new Chart(sleepchart, {
			type: 'pie',

			data: {
				datasets: [{
					data: [Awake, Rem, Light, Deep],
					backgroundColor: ["#E679BA7B", "#E6D66C65", "#E65DA3C3", "#E67A5DAC"]
				}],
				labels: ['Hours Awake', 'Hours of REM Sleep', 'Hours of Light Sleep', 'Hours of Deep Sleep']
			},

			options: {
				title: {
					text: "Sleep Breakdown",
					display: true
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				plugins: {
					labels: {
						render: 'value',
						fontStyle: 'bold',
						shadowBlur: '0'
					}

				},
				//centertext: {{ Summary[2] }}

			}

		});

	</script>

	<script>

		let sleeptimechart = document.getElementById("SleepTimeChart").getContext('2d');
		let hoursSlept={{ Summary[6] }};
		hoursSlept=parseFloat(hoursSlept/60).toFixed(2);


		let sleeptimechart1 = new Chart(sleeptimechart, {
			type: 'pie',
			
			data: {
				datasets: [{
					data: [hoursSlept, 9-hoursSlept],
					backgroundColor: ["rgba(0,255,0,0.5)", "rgba(255,0,0,0.5)"]
				}],
				labels: ['Hours Slept', 'Hours Awake']
			},

			options: {
				title: {
					text: 'Hours Slept',
					display: true
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				plugins: {
					labels: {
						render: 'value',
						fontStyle: 'bold',
						shadowBlur: '0'
					}

				},
				//centertext: "0",
				

			}

		});

	</script>


	<script>
		let labels1 = [...Array(24)].map((_, i) => i + 1);
		let data1 = [
			{% for item in todayData[1] %}
		"{{ item }}",
			{% endfor %}
				    ];
		console.log(data1)

		let myChart1 = document.getElementById("StepChart1").getContext('2d');

		let chart1 = new Chart(myChart1, {
			type: 'bar',

			data: {
				labels: labels1,
				datasets: [{
					data: data1,
					backgroundColor: '#f06262',
				}]
			},

			options: {
				title: {
					text: "Total Steps per hour",
					display: true
				},
				scales: {
					yAxes: [{
						ticks: {
							beginAtZero: true
						},
						scaleLabel: {
							display: true,
							labelString: 'Steps'
						}
					}],
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Time'
						}
					}],
				},
				legend: {
					display: false
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				plugins: {
  							labels: false
						}
				
			}

		});

		let labels2 = ['00:00', '01:00', '02:00', '03:00', '04:00', '05:00', '06:00', '07:00', '08:00',
			'09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '22:00', '23:00'];
		let data2 = [{% for item in todayData[9] %}
		"{{ item }}",
			{% endfor %}];
		let colors2 = [];

		for (let heartrate in data2) {
			if (data2[heartrate] > 100) {
				colors2.push('rgba(255, 0, 0, 1)');
			}
			else if (data2[heartrate] < 60) {
				colors2.push('rgba(0, 85, 0,1)');

			}
			else if (data2[heartrate] >= 60 || data2[heartrate] <= 100) {
				colors2.push('rgba(255, 0, 0,1)');
			}

		}


		let myChart2 = document.getElementById("HeartChart2").getContext('2d');

		let chart2 = new Chart(myChart2, {
			type: 'line',

			data: {
				labels: labels2,
				datasets: [{
					lineTension: 0.1,
					borderColor:'#80FF85',
					backgroundColor: '#f06262',
					//borderColor: "rgba(255,192,192,1)",
					pointBorderColor: "rgba(75,192,192,1)",
					pointBackgroundColor: "rgba(0,155,0,1)",
					pointBorderWidth: 1,
					pointHoverRadius: 5,
					pointHoverBackgroundColor: "rgba(75,192,192,1)",
					fill:false,
					data: data2,

				}]
			},

			options: {
				title: {
					text: "Heart Rate",
					display: true
				},
				scales: {
					yAxes: [{
						ticks: {
							beginAtZero: true
						},
						scaleLabel: {
							display: true,
							labelString: 'Heart Rate'
						}
					}],
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Time'
						}
					}],
				},
				legend: {
					display: false
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
			}

		});




		let labels3 = [...Array(24)].map((_, i) => i + 1);;
		let data3 = [{% for item in todayData[0] %}
		"{{ item }}",
			{% endfor %}];
		let colors3 = ['#49A9EA'];

		let myChart3 = document.getElementById("CaloriesChart").getContext('2d');

		let chart3 = new Chart(myChart3, {
			type: 'bar',

			data: {
				labels: labels3,
				datasets: [{
					lineTension: 0.1,
					backgroundColor: '#f06262',
					fill: false,
					data: data3,
				}]
			},

			options: {
				title: {
					text: "Calories Burned",
					display: true
				},
				scales: {
					yAxes: [{
						ticks: {
							beginAtZero: true
						},
						scaleLabel: {
							display: true,
							labelString: 'Calories'
						}
					}],
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Time'
						}
					}],
				},
				legend: {
					display: false
				},
				plugins: {
  							labels: false
						}
			}

		});


		let labels4 = [...Array(24)].map((_, i) => i + 1);;
		let data4 = [{% for item in todayData[2] %}
		"{{ item }}",
			{% endfor %}];
		let colors4 = ['rgba(63, 191, 191,0.5)'];

		let myChart4 = document.getElementById("DistanceChart").getContext('2d');

		let chart4 = new Chart(myChart4, {
			type: 'bar',

			data: {
				labels: labels4,
				datasets: [{
					backgroundColor: '#f06262',
					fill: false,
					data: data4,
				}]
			},

			options: {
				title: {
					text: "Miles Walked",
					display: true
				},
				scales: {
					yAxes: [{
						ticks: {
							beginAtZero: true
						},
						scaleLabel: {
							display: true,
							labelString: 'Miles'
						}
					}],
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Time'
						}
					}],
				},
				legend: {
					display: false
				},
				plugins: {
 					 labels: false
				}		
			}

		});


		let labels5 = [...Array(24)].map((_, i) => i + 1);
		let data5 = [{% for item in todayData[3] %}
		"{{ item }}",
			{% endfor %}];
		let colors5 = ['#49A9EA'];

		let myChart5 = document.getElementById("FloorsChart").getContext('2d');

		let chart5 = new Chart(myChart5, {
			type: 'bar',

			data: {
				labels: labels4,
				datasets: [{
					backgroundColor: '#f06262',
					fill: false,
					data: data5,

				}]
			},

			options: {
				title: {
					text: "Floors Covered",
					display: true
				},
				scales: {
					yAxes: [{
						ticks: {
							beginAtZero: true
						},
						scaleLabel: {
							display: true,
							labelString: 'Floors'
						}
					}],
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Time'
						}
					}],
				},
				legend: {
					display: false
				},
				plugins: {
 					 labels: false
				}	
			}

		});
	</script>

	<script>
		var dynamic=setInterval(function () {
			$.ajax({
				url: "/web/data",
				type: 'GET',
				success: function (res) {
					//parse our response
					var Calories = res.calories;
					var Steps = res.steps;
					var CaloriesBMR = res.caloriesBMR;
					var Distance = res.distance;
					var Floors = res.floors;
					//update our charts dynamically by changing the data	
					chart1.data.datasets[0].data = Steps;
					chart2.data.datasets[0].data = CaloriesBMR;
					chart3.data.datasets[0].data = Calories;
					chart4.data.datasets[0].data = Distance;
					chart5.data.datasets[0].data = Floors;
					chart1.update();
					chart2.update();
					chart3.update();
					chart4.update();
					chart5.update();
				}
			});
		}, 40000);
		clearInterval(dynamic);

		function Refresh() {
			var StartDate = $('#start').val().split('/');
			var EndDate = $('#end').val().split('/');


			$.ajax({
				url: "/web/weekdata",
				type: "POST",
				data: {
					'Start': StartDate,
					'End': EndDate
				},
				success: function (res) {
					//var Calories=res.calories;
					WeeklyFitbitSummary = res.WeeklySummary
					WeeklySleepData = res.WeeklySleep
					WeeklyDaily = res.WeeklyHourly
					HeartRate = []
					Calories = []
					Steps = []
					Distance = []
					Floors = []
					Elevation = []
					Sleep = [0, 0, 0, 0]
					SleepHours = [0, 0]
					var i;
					for (i = 0; i < WeeklyDaily.length; i++) {
						Calories.push(WeeklyDaily[i][0]);
						Steps.push(WeeklyDaily[i][1]);
						Distance.push(WeeklyDaily[i][2]);
						Floors.push(WeeklyDaily[i][3]);
						Elevation.push(WeeklyDaily[i][4]);
						HeartRate.push(WeeklyDaily[i][9]);

					}
					for (i = 0; i < WeeklySleepData.length; i++) {
						Sleep[0] = parseFloat(Sleep[0]) + parseFloat(WeeklySleepData[i][0]);
						Sleep[1] = parseFloat(Sleep[1]) + parseFloat(WeeklySleepData[i][1]);
						Sleep[2] = parseFloat(Sleep[2]) + parseFloat(WeeklySleepData[i][2]);
						Sleep[3] = parseFloat(Sleep[3]) + parseFloat(WeeklySleepData[i][3]);

					}

					for (i = 0; i < WeeklyFitbitSummary.length; i++) {
						SleepHours[0] = parseFloat(SleepHours[0]) + parseFloat(WeeklyFitbitSummary[i][6])
						SleepHours[0] = (parseFloat(SleepHours[0]) / 60).toFixed(2);
						console.log(WeeklyFitbitSummary[i][6]);


					}

					SleepHours[1] = 63;


					Sleep[0] = Sleep[0].toFixed(2)
					Sleep[1] = Sleep[1].toFixed(2)
					Sleep[2] = Sleep[2].toFixed(2)
					Sleep[3] = Sleep[3].toFixed(2)

					//var Steps=res.steps;
					//var Rating=res.rating;
					//var HoursSlept=res.hours_slept;
					//var HeartRate= res.heart_rate;
					chart1.data.datasets[0].data = Steps;
					chart2.data.datasets[0].data = HeartRate;
					chart3.data.datasets[0].data = Calories;
					chart4.data.datasets[0].data = Distance;
					chart5.data.datasets[0].data = Floors;

					sleepchart1.data.datasets[0].data = Sleep;
					sleeptimechart1.data.datasets[0].data = SleepHours

					chart1.data.labels = res.Dates;
					chart2.data.labels = res.Dates;
					chart3.data.labels = res.Dates;
					chart4.data.labels = res.Dates;
					chart5.data.labels = res.Dates;
					//console.log(res)
					chart1.update();
					chart2.update();
					chart3.update();
					chart4.update();
					chart5.update();
					sleepchart1.update();
					sleeptimechart1.update();


					//$("#refresh").text("Weekly Summary");
				}
			});


		}

		function GetData() {
			var StartDate = $('#start').val().split('/');
			var EndDate = $('#end').val().split('/');
			$.ajax({
				url: "/web/datedata",
				type: "POST",
				data: {
					'Start': StartDate,
					'End': EndDate
				},
				success: function (res) {
					console.log(res);
					WeeklyFitbitSummary = res.Summary
					WeeklySleepData = res.SleepData
					WeeklyDaily = res.Daily
					HeartRate = []
					Calories = []
					Steps = []
					Distance = []
					Floors = []
					Elevation = []
					Sleep = [0, 0, 0, 0]
					SleepHours = [0, 0]
					ActivityHours = [0, 0, 0, 0]
					colorsHeartRate = []
					colorsSteps = []
					colorsDistance = []
					colorsFloors = []
					colorsElevation = []
					colorsCalories = []
					totalActivityminutes=0
					var i;
					//go through our array which holds the data  for the current timeframe
					for (i = 0; i < WeeklyDaily.length; i++) {
						Calories.push(WeeklyDaily[i][0]);
						Steps.push(WeeklyDaily[i][1]);
						Distance.push(WeeklyDaily[i][2]);
						Floors.push(WeeklyDaily[i][3]);
						Elevation.push(WeeklyDaily[i][4]);
						HeartRate.push(WeeklyDaily[i][9]);
						console.log(WeeklyDaily[i][9]);
						//check the heartrate and determine the color to push to the graph's colors array
						if (parseFloat(WeeklyDaily[i][9]) < 60 || parseFloat(WeeklyDaily[i][9] > 100)) {
							colorsHeartRate.push('rgba(255, 0, 0, 1)');
						}
						else {
							colorsHeartRate.push('rgba(0, 255, 0, 1)');
						}

						if (parseFloat(WeeklyDaily[i][1]) > 0) {
							colorsSteps.push('rgba(0, 255, 0, 1)');

						}
						else {
							colorsSteps.push('rgba(255, 0, 0, 1)');
						}
						if (parseFloat(WeeklyDaily[i][0]) > 0) {
							colorsCalories.push('rgba(0, 255, 0, 1)');

						}
						else {
							colorsCalories.push('rgba(255, 0, 0, 1)');
						}

						if (parseFloat(WeeklyDaily[i][2]) > 0) {
							colorsDistance.push('rgba(0, 255, 0, 1)');

						}
						else {
							colorsDistance.push('rgba(255, 0, 0, 1)');
						}
						if (parseFloat(WeeklyDaily[i][3]) > 0) {
							colorsFloors.push('rgba(0, 255, 0, 1)');

						}
						else {
							colorsFloors.push('rgba(255, 0, 0, 1)');
						}
						if (parseFloat(WeeklyDaily[i][4]) > 0) {
							colorsElevation.push('rgba(0, 255, 0, 1)');

						}
						else {
							colorsElevation.push('rgba(255, 0, 0, 1)');
						}
						//check if 
						if (WeeklyDaily[i][5] == undefined) {
							continue;
						}
						else {
							ActivityHours[0] = ActivityHours[0] + parseInt(WeeklyDaily[i][5]);
							ActivityHours[1] = ActivityHours[1] + parseInt(WeeklyDaily[i][6]);
							ActivityHours[2] = ActivityHours[2] + parseInt(WeeklyDaily[i][7]);
							ActivityHours[3] = ActivityHours[3] + parseInt(WeeklyDaily[i][8]);
						}
					}
					console.log(ActivityHours)
					//collect the Sleep stages information ie [rem,etc]
					for (i = 0; i < WeeklySleepData.length; i++) {
						Sleep[0] = parseFloat(Sleep[0]) + parseFloat(WeeklySleepData[i][0]);
						Sleep[1] = parseFloat(Sleep[1]) + parseFloat(WeeklySleepData[i][1]);
						Sleep[2] = parseFloat(Sleep[2]) + parseFloat(WeeklySleepData[i][2]);
						Sleep[3] = parseFloat(Sleep[3]) + parseFloat(WeeklySleepData[i][3]);

					}

					for (i = 0; i < WeeklyFitbitSummary.length; i++) {
						//check if the sleep field is empty in the response
						if (WeeklyFitbitSummary[i][6] === undefined) {
							continue;

						}
						//sum up sleep and convert from minutes to hours
						SleepHours[0] = parseFloat(SleepHours[0]) + parseFloat(WeeklyFitbitSummary[i][6])
						SleepHours[0] = (parseFloat(SleepHours[0]) / 60).toFixed(2);


					}

					SleepHours[1] = 63 - parseFloat(SleepHours[0]);


					Sleep[0] = Sleep[0].toFixed(2)
					Sleep[1] = Sleep[1].toFixed(2)
					Sleep[2] = Sleep[2].toFixed(2)
					Sleep[3] = Sleep[3].toFixed(2)

					//var Steps=res.steps;
					//var Rating=res.rating;
					//var HoursSlept=res.hours_slept;
					//var HeartRate= res.heart_rate;
					chart1.data.datasets[0].data = Steps;
					chart1.data.datasets[0].backgroundColor = colorsSteps;
					chart1.data.datasets[0].borderColor = colorsSteps;
					chart1.data.datasets[0].pointBorderColor = colorsSteps;
					chart1.data.datasets[0].backgroundColor = colorsSteps;
					chart1.data.datasets[0].pointBackgroundColor = colorsSteps;


					chart2.data.datasets[0].data = HeartRate;

					//adjust the Heart rate chart's colors
					chart2.data.datasets[0].backgroundColor = colorsHeartRate;
					chart2.data.datasets[0].borderColor = colorsHeartRate;
					chart2.data.datasets[0].pointBorderColor = colorsHeartRate;
					chart2.data.datasets[0].backgroundColor = colorsHeartRate;
					chart2.data.datasets[0].pointBackgroundColor = colorsHeartRate;

					//adjust the calories chart with the updated data
					chart3.data.datasets[0].data = Calories;
					chart3.data.datasets[0].backgroundColor = colorsCalories;
					chart3.data.datasets[0].borderColor = colorsCalories;
					chart3.data.datasets[0].pointBorderColor = colorsCalories;
					chart3.data.datasets[0].backgroundColor = colorsCalories;
					chart3.data.datasets[0].pointBackgroundColor = colorsCalories;
					//update the distance chart with the updated data
					chart4.data.datasets[0].data = Distance;
					chart4.data.datasets[0].backgroundColor = colorsDistance;
					chart4.data.datasets[0].borderColor = colorsDistance;
					chart4.data.datasets[0].pointBorderColor = colorsDistance;
					chart4.data.datasets[0].backgroundColor = colorsDistance;
					chart4.data.datasets[0].pointBackgroundColor = colorsDistance;

					//update the floors chart with the updated data
					chart5.data.datasets[0].data = Floors;
					chart5.data.datasets[0].backgroundColor = colorsFloors;
					chart5.data.datasets[0].borderColor = colorsFloors;
					chart5.data.datasets[0].pointBorderColor = colorsFloors;
					chart5.data.datasets[0].backgroundColor = colorsFloors;
					chart5.data.datasets[0].pointBackgroundColor = colorsFloors;
					//update the sleepchart
					sleepchart1.data.datasets[0].data = Sleep;
					sleeptimechart1.data.datasets[0].data = SleepHours;
					activitychart1.data.datasets[0].data = ActivityHours;

					chart1.data.labels = res.Dates;
					chart2.data.labels = res.Dates;
					chart3.data.labels = res.Dates;
					chart4.data.labels = res.Dates;
					chart5.data.labels = res.Dates;

					//tell the charts to update with the new information, or "refresh" with the new data
					chart1.update();
					chart2.update();
					chart3.update();
					chart4.update();
					chart5.update();
					sleepchart1.update();
					sleeptimechart1.update();
					activitychart1.update();

				}
			});

		}

	</script>


</body>
<style>
table, th, td {
	border: 1px solid black;
	border-collapse: collapse;
}
</style>
</html>
{% endblock %}